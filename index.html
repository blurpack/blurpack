<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <title>erows – Static Typography</title>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --circle-size: 70vmin;
        }

        html, body {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden;
            background: var(--bg-color);
            font-family: "Pretendard", sans-serif;
            touch-action: none; 
            user-select: none;
            -webkit-user-select: none;
        }

        /* 배경 레이어: 이미지가 상하좌우에 딱 붙도록 설정 */
        .bg-layer {
            position: fixed; 
            inset: 0; /* top, right, bottom, left 모두 0 */
            z-index: 1; 
            opacity: 0.5;
            transition: filter 0.2s ease-out;
            will-change: filter;
            pointer-events: none;
        }

        .bg-layer img {
            width: 100%;
            height: 100%;
            object-fit: fill; /* 이미지 비율이 변해도 화면에 꽉 채움 */
            display: block;
        }

        .viewport-circle {
            position: fixed;
            width: var(--circle-size); height: var(--circle-size);
            left: 50%; top: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            background: var(--bg-color);
            overflow: hidden;
            z-index: 10;
            cursor: grab;
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.15), 0 0 50px rgba(0, 0, 0, 0.05);
            touch-action: none;
        }

        .world-plane { 
            position: absolute; 
            width: 100%; height: 100%; 
            will-change: transform; 
        }

        .category-node {
            position: absolute; left: 50%; top: 50%;
            font-size: 4rem; font-weight: 900; 
            cursor: pointer; 
            color: var(--text-color);
            user-select: none;
            will-change: filter, transform;
            white-space: nowrap;
        }

        #content-layer {
            position: fixed; top: -100%; left: 0; width: 100%; height: 100%;
            z-index: 100; background: var(--bg-color); overflow-y: auto;
            transition: top 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            touch-action: pan-y;
        }
        #content-layer.active { top: 0; }

        .tile-grid { display: grid; grid-template-columns: repeat(1, 1fr); width: 100%; }
        .tile-item { position: relative; width: 100%; aspect-ratio: 1 / 1; overflow: hidden; background: #eee; }
        .tile-item img { width: 100%; height: 100%; object-fit: cover; display: block; }

        @media (min-width: 769px) {
            .tile-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            :root { --circle-size: 85vmin; }
            .category-node { font-size: 2.5rem; }
        }
    </style>
</head>
<body oncontextmenu="return false;"> 
    
    <div class="bg-layer" id="bgLayer">
        <img src="bpm.jpg" alt="background">
    </div>

    <div class="viewport-circle" id="circle">
        <div class="world-plane" id="world"></div>
    </div>

    <div id="content-layer">
        <div class="tile-grid" id="image-gallery"></div>
    </div>

<script>
    const categories = [
        { id: "projects", label: "PROJECTS", x: -400, y: -300 },
        { id: "music",    label: "MUSIC",    x: 550,  y: -150 },
        { id: "movie",    label: "MOVIE",    x: -300, y: 450  },
        { id: "profile",  label: "PROFILE",  x: 0,    y: 0    }
    ];

    const world = document.getElementById("world");
    const contentLayer = document.getElementById("content-layer");
    const bgLayer = document.getElementById("bgLayer");

    const nodes = categories.map(cat => {
        const div = document.createElement("div");
        div.className = "category-node";
        div.textContent = cat.label;
        div.onclick = () => { if (Math.abs(vx) < 1.5) openPage(cat.label); };
        world.appendChild(div);
        return { el: div, x: cat.x, y: cat.y };
    });

    function openPage(name) {
        history.pushState({ page: name }, name, `#${name}`);
        const grid = document.getElementById("image-gallery");
        grid.innerHTML = ""; 
        for (let i = 0; i < 16; i++) {
            const tile = document.createElement("div");
            tile.className = "tile-item";
            const img = document.createElement("img");
            img.src = `https://picsum.photos/800/800?random=${name}${i}`;
            tile.appendChild(img);
            grid.appendChild(tile);
        }
        contentLayer.classList.add('active');
    }

    window.onpopstate = () => { if (contentLayer.classList.contains('active')) contentLayer.classList.remove('active'); };

    let posX = 0, posY = 0, vx = 0, vy = 0, isDragging = false, lastX = 0, lastY = 0;
    const friction = 0.94;

    const start = (x, y) => { if(contentLayer.classList.contains('active')) return; isDragging = true; lastX = x; lastY = y; };
    const move = (x, y) => { if (!isDragging) return; const dx = x - lastX, dy = y - lastY; posX += dx; posY += dy; vx = dx; vy = dy; lastX = x; lastY = y; };
    
    const circle = document.getElementById("circle");
    circle.addEventListener('mousedown', e => start(e.clientX, e.clientY));
    window.addEventListener('mousemove', e => move(e.clientX, e.clientY));
    window.addEventListener('mouseup', () => isDragging = false);
    circle.addEventListener('touchstart', e => start(e.touches[0].clientX, e.touches[0].clientY));
    window.addEventListener('touchmove', e => move(e.touches[0].clientX, e.touches[0].clientY));
    window.addEventListener('touchend', () => isDragging = false);

    function animate() {
        if (!isDragging && !contentLayer.classList.contains('active')) {
            posX += vx; posY += vy; 
            vx *= friction; vy *= friction;
        }
        world.style.transform = `translate(${posX}px, ${posY}px)`;
        nodes.forEach(node => {
            const currentX = node.x + posX;
            const currentY = node.y + posY;
            const distance = Math.sqrt(currentX * currentX + currentY * currentY);
            const blurVal = Math.min(15, distance / 40); 
            node.el.style.transform = `translate(-50%, -50%) translate(${node.x}px, ${node.y}px)`;
            node.el.style.filter = `blur(${blurVal}px)`;
            const opacityVal = Math.max(0.2, 1 - (distance / 800));
            node.el.style.opacity = opacityVal;
        });

        const speed = Math.sqrt(vx * vx + vy * vy);
        const bgBlurVal = Math.min(20, (speed * 0.1)); 
        if (bgLayer) bgLayer.style.filter = `blur(${bgBlurVal}px)`;
        
        requestAnimationFrame(animate);
    }
    animate();
</script>
</body>
</html>
