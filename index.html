<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>blurpack</title>
    
    <script src="data.js"></script>

    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --circle-size: 70vmin;
            --center-img-size: 340px; 
        }

        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: var(--bg-color); 
            font-family: "Pretendard", sans-serif; 
            touch-action: none; user-select: none; -webkit-user-select: none; 
        }
        
        /* [메인 컨테이너] */
        #main-container {
            position: fixed; inset: 0; width: 100%; height: 100%;
            transition: filter 1.5s ease; 
            z-index: 10;
        }

        /* 흐림 효과 (안개) */
        #main-container.blurred {
            filter: blur(50px);
        }

        .bg-layer { 
            position: absolute; inset: 0; 
            opacity: 0.9; 
            filter: blur(400px); 
            transition: filter 0.5s ease-out; 
        }
        .bg-layer img { width: 100%; height: 100%; object-fit: fill; }
        
        /* [원형 메뉴] */
        .viewport-circle { 
            position: absolute; width: var(--circle-size); height: var(--circle-size); 
            left: 50%; top: 50%; transform: translate(-50%, -50%); 
            border-radius: 50%; background: var(--bg-color); overflow: hidden; 
            box-shadow: inset 0 0 30px rgba(0,0,0,0.1), 0 0 50px rgba(0,0,0,0.05); 
            
            /* 초기 상태: 완전 투명 */
            opacity: 0; 
            /* 천천히 나타남 */
            transition: opacity 1.5s ease; 
        }
        
        /* 등장 클래스 */
        .viewport-circle.visible {
            opacity: 1;
        }

        .world-plane { position: absolute; width: 100%; height: 100%; }
        
        .category-node { 
            position: absolute; left: 50%; top: 50%; 
            font-size: 3rem; font-weight: 900; 
            cursor: pointer; color: var(--text-color); 
            white-space: nowrap; text-transform: lowercase; 
        }
        
        .center-image-node { 
            position: absolute; left: 50%; top: 50%; 
            width: var(--center-img-size); height: auto; 
            transform: translate(-50%, -50%); pointer-events: none; 
        }
        
        /* 콘텐츠 레이어 */
        #content-layer { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            z-index: 100; background: transparent; 
            overflow-y: auto; 
            
            opacity: 0; filter: blur(30px); 
            pointer-events: none; 

            transition: opacity 1.5s ease, filter 1.5s ease;
        }

        #content-layer.active { 
            opacity: 1; filter: blur(0px);
            pointer-events: auto;
            background: rgba(255, 255, 255, 0.85); 
        }

        .tile-grid { display: grid; grid-template-columns: repeat(1, 1fr); width: 100%; }
        
        .tile-item { position: relative; width: 100%; aspect-ratio: 1 / 1; cursor: pointer; overflow: hidden; background: #eee; }
        .tile-item img { width: 100%; height: 100%; object-fit: cover; display: block; transition: filter 0.5s ease, transform 0.5s ease; }
        
        .tile-overlay {
            position: absolute; inset: 0;
            display: flex; align-items: center; justify-content: center;
            color: rgba(255, 255, 255, 0.75); 
            opacity: 0; transition: opacity 0.5s ease;
            pointer-events: none; z-index: 2;
        }

        .music-container { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        
        .album-title { position: absolute; right: 30px; top: 50%; transform: translateY(-50%) rotate(90deg); transform-origin: center; white-space: nowrap; font-size: 1rem; font-weight: bold; }
        .artist-name { position: absolute; left: 30px; top: 50%; transform: translateY(-50%) rotate(-90deg); transform-origin: center; white-space: nowrap; font-size: 1rem; font-weight: bold; }

        .track-list { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 12px; width: 60%; }
        .track-item { font-size: 0.95rem; text-align: center; line-height: 1.2; }
        .track-item.low-priority { filter: blur(5px); opacity: 0.3; }

        .tile-item.show-info img { filter: blur(30px); transform: scale(1.1); }
        .tile-item.show-info .tile-overlay { opacity: 1; }

        @media (min-width: 769px) { .tile-grid { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body oncontextmenu="return false;">
    
    <div id="main-container">
        <div class="bg-layer" id="bgLayer"><img src="bpm.webp" onerror="this.style.backgroundColor='#ccc'"></div>
        <div class="viewport-circle" id="circle">
            <div class="world-plane" id="world">
                <img src="bp_logo_c.webp" class="center-image-node" id="centerImage" onerror="this.src='https://via.placeholder.com/150'">
            </div>
        </div>
    </div>

    <div id="content-layer"><div class="tile-grid" id="image-gallery"></div></div>

<script>
    document.addEventListener('keydown', e => { if (e.ctrlKey && ['+', '-', '=', '0'].includes(e.key)) e.preventDefault(); });
    document.addEventListener('wheel', e => { if (e.ctrlKey) e.preventDefault(); }, { passive: false });
    document.addEventListener('touchmove', e => { if (e.touches.length > 1) e.preventDefault(); }, { passive: false });

    const categories = [ { id: "blurpacks", label: "blurpacks", x: -400, y: -250 }, { id: "musics", label: "musics", x: 450, y: -100 }, { id: "movies", label: "movies", x: -100, y: 350 } ];
    
    const mainContainer = document.getElementById("main-container");
    const world = document.getElementById("world");
    const centerImg = document.getElementById("centerImage");
    const contentLayer = document.getElementById("content-layer");
    const bgLayer = document.getElementById("bgLayer");
    const circle = document.getElementById("circle");
    const gallery = document.getElementById("image-gallery");
    
    let isIntroPlaying = true;
    let hasInteracted = false;

    const nodes = categories.map(cat => {
        const div = document.createElement("div"); div.className = "category-node"; div.textContent = cat.label;
        div.onclick = () => { if (!isIntroPlaying && hasInteracted) openPage(cat.id); };
        world.appendChild(div);
        return { el: div, x: cat.x, y: cat.y };
    });
    nodes.push({ el: centerImg, x: 0, y: 0 });

    // [1단계] 로드 시: 배경만 선명해짐 (원은 안 보임)
    window.onload = () => { 
        setTimeout(() => { 
            bgLayer.style.filter = "blur(7px)"; 
        }, 100);
    };

    // [2단계] 인터랙션 시작 함수
    function startInteraction() {
        if (hasInteracted) return;
        hasInteracted = true;

        // 1. 먼저 전체 화면을 흐리게 만듦 (안개 생성)
        mainContainer.classList.add('blurred');

        // 2. [수정됨] 0.6초 뒤에 원을 등장시킴 (한 박자 늦게)
        // 안개가 충분히 낀 상태에서 원이 스르륵 나옴
        setTimeout(() => {
            circle.classList.add('visible');
        }, 200); 

        // 3. 충분한 시간이 지난 뒤 (1.8초) 안개를 걷음
        setTimeout(() => {
            mainContainer.classList.remove('blurred');
            isIntroPlaying = false; 
        }, 500); 
    }

    window.addEventListener('click', startInteraction);
    window.addEventListener('touchstart', startInteraction);


    function openPage(catId) {
        history.pushState({ page: catId }, catId, `#${catId}`);
        gallery.innerHTML = ""; 
        
        mainContainer.classList.add('blurred');
        
        requestAnimationFrame(() => {
            contentLayer.classList.add('active');
        });

        let items = [];
        if (typeof myPortfolioData !== 'undefined' && myPortfolioData[catId]) {
            items = myPortfolioData[catId];
        } else {
            gallery.innerHTML = "<p style='padding:20px; color:red;'>data.js 확인 필요</p>";
            return;
        }

        items.forEach(item => {
            const tile = document.createElement("div"); tile.className = "tile-item";
            tile.onclick = () => {
                const isShown = tile.classList.contains('show-info');
                document.querySelectorAll('.tile-item').forEach(t => t.classList.remove('show-info'));
                if(!isShown) tile.classList.add('show-info');
            };

            let overlayHtml = "";
            if (catId === "musics") {
                const tracks = item.tracks ? item.tracks.split(',').map(t => {
                    const tName = t.trim(); const isLow = tName.startsWith('*');
                    return `<div class="track-item ${isLow ? 'low-priority' : ''}">${isLow ? tName.substring(1) : tName}</div>`;
                }).join('') : '';
                
                overlayHtml = `
                    <div class="music-container">
                        <div class="album-title">${item.title}</div>
                        <div class="artist-name">${item.artist}</div>
                        <div class="track-list">${tracks}</div>
                    </div>
                `;
            } else {
                overlayHtml = `<div style="font-size:1.5rem; font-weight:bold;">${item.title}</div>`;
            }

            tile.innerHTML = `
                <img src="${catId}/${item.img}" onerror="this.src='https://via.placeholder.com/600x600/ccc/333?text=Image+Not+Found'">
                <div class="tile-overlay">${overlayHtml}</div>
            `;
            gallery.appendChild(tile);
        });
    }

    window.onpopstate = () => { 
        contentLayer.classList.remove('active');
        mainContainer.classList.remove('blurred');
    };

    let posX = 0, posY = 0, vx = 0, vy = 0, isDragging = false, lastX = 0, lastY = 0;
    const start = (x, y) => { if(isIntroPlaying || contentLayer.classList.contains('active')) return; isDragging = true; lastX = x; lastY = y; };
    const move = (x, y) => { if (!isDragging) return; const dx = x - lastX, dy = y - lastY; posX += dx; posY += dy; vx = dx; vy = dy; lastX = x; lastY = y; };
    circle.addEventListener('mousedown', e => start(e.clientX, e.clientY));
    window.addEventListener('mousemove', e => move(e.clientX, e.clientY));
    window.addEventListener('mouseup', () => isDragging = false);
    circle.addEventListener('touchstart', e => start(e.touches[0].clientX, e.touches[0].clientY));
    window.addEventListener('touchmove', e => move(e.touches[0].clientX, e.touches[0].clientY));
    window.addEventListener('touchend', () => isDragging = false);
    function animate() {
        if (!isDragging && !contentLayer.classList.contains('active')) { posX += vx; posY += vy; vx *= 0.94; vy *= 0.94; }
        world.style.transform = `translate(${posX}px, ${posY}px)`;
        nodes.forEach(node => {
            const dist = Math.sqrt((node.x + posX)**2 + (node.y + posY)**2);
            node.el.style.transform = `translate(-50%, -50%) translate(${node.x}px, ${node.y}px)`;
            if (!isIntroPlaying) node.el.style.filter = `blur(${Math.min(15, dist / 40)}px)`;
            node.el.style.opacity = Math.max(0.1, 1 - (dist / 700));
        });
        requestAnimationFrame(animate);
    }
    animate();
</script>
</body>
</html>
